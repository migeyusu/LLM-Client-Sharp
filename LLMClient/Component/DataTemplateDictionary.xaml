<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    x:Class="LLMClient.Component.DataTemplateDictionary"
                    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                    xmlns:openAiapi="clr-namespace:LLMClient.Endpoints.OpenAIAPI"
                    xmlns:endpoints="clr-namespace:LLMClient.Endpoints"
                    xmlns:abstraction="clr-namespace:LLMClient.Abstraction"
                    xmlns:configuration="clr-namespace:LLMClient.Configuration"
                    xmlns:toolCall="clr-namespace:LLMClient.ToolCall"
                    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:component="clr-namespace:LLMClient.Component"
                    xmlns:viewModel="clr-namespace:LLMClient.Component.ViewModel"
                    xmlns:extension="clr-namespace:LLMClient.Component.Extension"
                    xmlns:converters="clr-namespace:LLMClient.Component.Converters"
                    xmlns:models="clr-namespace:LLMClient.Endpoints.Azure.Models"
                    xmlns:project="clr-namespace:LLMClient.Project"
                    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
                    xmlns:utility="clr-namespace:LLMClient.Component.Utility">
    <ItemsPanelTemplate x:Key="HorizontalItemsPanelTemplate">
        <StackPanel Orientation="Horizontal"
                    IsItemsHost="True" />
    </ItemsPanelTemplate>
    <ItemsPanelTemplate x:Key="VerticalItemsPanelTemplate">
        <StackPanel Orientation="Vertical"
                    IsItemsHost="True" />
    </ItemsPanelTemplate>
    <DataTemplate x:Key="UsageCountDataTemplate"
                  DataType="{x:Type abstraction:UsageCount}">
        <TextBlock FontSize="12"
                   Margin="0,5,0,0">
            <TextBlock.Text>
                <MultiBinding
                    StringFormat="CompletionTokens: {0}K   Calls: {1}Times   Price: ${2:F6}   Avg TPS: {3:F2}">
                    <Binding Path="CompletionTokens" Mode="OneWay"
                             Converter="{StaticResource KUnitConverter}" />
                    <Binding Path="CallTimes" Mode="OneWay" />
                    <Binding Path="Price" Mode="OneWay" />
                    <Binding Path="AverageTps" Mode="OneWay" />
                </MultiBinding>
            </TextBlock.Text>
        </TextBlock>
    </DataTemplate>
    <component:TypeBasedDataTemplateSelector x:Key="ModelsDataTemplateSelector">
        <component:DataTemplateTypePair>
            <HierarchicalDataTemplate DataType="{x:Type abstraction:ILLMAPIEndpoint}"
                                      ItemsSource="{Binding AvailableModels,Mode=OneWay}">
                <StackPanel Orientation="Horizontal">
                    <Image Source="{Binding Icon.CurrentSource,Mode=OneWay}"
                           Width="26"
                           Height="26" />
                    <TextBlock Margin="10,0"
                               VerticalAlignment="Center"
                               Text="{Binding DisplayName,Mode=OneWay}" />
                </StackPanel>
            </HierarchicalDataTemplate>
        </component:DataTemplateTypePair>
        <component:DataTemplateTypePair>
            <DataTemplate DataType="{x:Type abstraction:IEndpointModel}">
                <StackPanel Orientation="Horizontal">
                    <Image Width="23"
                           Height="23"
                           Source="{Binding Icon.CurrentSource,Mode=OneWay}" />
                    <TextBlock Text="{Binding Name,Mode=OneWay}"
                               Margin="10,0,0,0"
                               VerticalAlignment="Center" />
                </StackPanel>
            </DataTemplate>
        </component:DataTemplateTypePair>
    </component:TypeBasedDataTemplateSelector>
    <DataTemplate x:Key="FunctionTreeDataTemplate"
                  DataType="{x:Type toolCall:AIFunctionTreeSelectorViewModel}">
        <Grid Width="400"
              Height="500">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TreeView ItemsSource="{Binding FunctionGroups,Mode=OneWay}">
                <TreeView.Resources>
                    <HierarchicalDataTemplate DataType="{x:Type toolCall:CheckableFunctionGroupTree}"
                                              ItemsSource="{Binding Functions,Mode=OneWay}">
                        <CheckBox IsThreeState="True"
                                  IsEnabled="{Binding Data.IsAvailable,Mode=OneWay}"
                                  IsChecked="{Binding IsSelected,Mode=TwoWay}"
                                  materialDesign:CheckBoxAssist.CheckBoxSize="20">
                            <TextBlock TextWrapping="NoWrap"
                                       TextTrimming="CharacterEllipsis"
                                       FontWeight="Bold"
                                       FontSize="14"
                                       MaxHeight="20"
                                       MaxWidth="120"
                                       Text="{Binding Name,Mode=OneTime}" />
                        </CheckBox>
                    </HierarchicalDataTemplate>
                    <DataTemplate DataType="{x:Type toolCall:VirtualFunctionViewModel}">
                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                  IsEnabled="{Binding IsEnabled,Mode=OneWay}"
                                  ToolTip="{Binding Description,Mode=OneWay}"
                                  ToolTipService.InitialShowDelay="0"
                                  ToolTipService.Placement="Top"
                                  VerticalContentAlignment="Center">
                            <TextBlock MaxHeight="20"
                                       MaxWidth="300"
                                       Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                                       TextTrimming="CharacterEllipsis"
                                       TextWrapping="Wrap"
                                       Margin="5,0,0,0">
                                <Run Text="{Binding FunctionName,Mode=OneTime}" />
                                <Run Text="{Binding Description,Mode=OneWay}"
                                     FontSize="10"
                                     FontWeight="Normal" />
                            </TextBlock>
                        </CheckBox>
                    </DataTemplate>
                </TreeView.Resources>
            </TreeView>
            <materialDesign:Card Grid.Row="0"
                                 Padding="4"
                                 VerticalAlignment="Center"
                                 HorizontalAlignment="Center"
                                 materialDesign:ElevationAssist.Elevation="Dp4"
                                 Visibility="{Binding IsEnsuring,Mode=OneWay,Converter={x:Static materialDesign:BooleanToVisibilityConverter.CollapsedInstance}}"
                                 UniformCornerRadius="14">
                <StackPanel Margin="10">
                    <ProgressBar IsIndeterminate="True"
                                 Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 Value="50" />
                    <TextBlock Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                               TextWrapping="Wrap"
                               Margin="0,15,0,0"
                               Text="正在刷新服务。。。。。" />
                    <Button Style="{StaticResource MaterialDesignOutlinedLightButton}"
                            Width="60"
                            Content="停止"
                            Margin="0,15,0,0"
                            Command="{Binding CancelRefreshCommand}" />
                </StackPanel>
            </materialDesign:Card>
            <ComboBox Grid.Row="1"
                      Width="120"
                      HorizontalAlignment="Left"
                      VerticalAlignment="Center"
                      ToolTip="When only model don't support function call, only 'Prompt' mode is enable."
                      ToolTipService.InitialShowDelay="0"
                      BorderThickness="0"
                      materialDesign:HintAssist.Hint="Call Mode"
                      Padding="6,3"
                      ItemsSource="{Binding SelectableCallEngineTypes,Mode=OneWay}"
                      SelectedItem="{Binding EngineType,Mode=TwoWay}" />
            <StackPanel Grid.Row="1"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal"
                        Margin="0,10,0,0">
                <Button Content="刷新"
                        Command="{Binding RefreshSourceCommand}"
                        Style="{StaticResource MaterialDesignOutlinedButton}"
                        Width="90" />
                <Button Content="确定"
                        Margin="16,0,0,0"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Width="90"
                        Command="{Binding SelectCommand}" />
            </StackPanel>
        </Grid>
    </DataTemplate>
    <DataTemplate x:Key="PopupSelectModelDataTemplate"
                  DataType="{x:Type viewModel:BaseModelSelectionViewModel}">
        <StackPanel Margin="5,10"
                    Width="370">
            <materialDesign:Flipper Height="250"
                                    materialDesign:ElevationAssist.Elevation="Dp0"
                                    BorderThickness="0"
                                    HorizontalContentAlignment="Stretch"
                                    HorizontalAlignment="Stretch">
                <materialDesign:Flipper.FrontContent>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="Endpoints View"
                                   FontWeight="Black"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Left"
                                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}" />
                        <Button Grid.Row="0"
                                HorizontalAlignment="Right"
                                Margin="0"
                                Width="32"
                                Height="32"
                                Command="{x:Static materialDesign:Flipper.FlipCommand}"
                                Content="{materialDesign:PackIcon Kind=SwapHorizontalBold}"
                                Style="{StaticResource MaterialDesignIconButton}" />
                        <DockPanel Grid.Row="1"
                                   Margin="0,10,0,0">
                            <ListBox DisplayMemberPath="DisplayName"
                                     Width="150"
                                     SelectedIndex="0"
                                     x:Name="AvailableEndpointsListBox"
                                     ItemsSource="{Binding Source={extension:Service {x:Type abstraction:IEndpointService}},Path=CandidateEndpoints,Mode=OneWay}" />
                            <ListBox DockPanel.Dock="Right"
                                     HorizontalAlignment="Stretch"
                                     DisplayMemberPath="Name"
                                     materialDesign:RippleAssist.IsDisabled="True"
                                     SelectedItem="{Binding SelectedModel,Mode=TwoWay}"
                                     ItemsSource="{Binding ElementName=AvailableEndpointsListBox,Path=SelectedItem.AvailableModels,Mode=OneWay}">
                                <b:Interaction.Triggers>
                                    <b:EventTrigger EventName="MouseDoubleClick">
                                        <b:InvokeCommandAction CommandParameter="{Binding }"
                                                               Command="{x:Static viewModel:BaseModelSelectionViewModel.CreateDefaultCommand}" />
                                    </b:EventTrigger>
                                </b:Interaction.Triggers>
                            </ListBox>
                        </DockPanel>
                    </Grid>
                </materialDesign:Flipper.FrontContent>
                <materialDesign:Flipper.BackContent>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="Models View"
                                   FontWeight="Black"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Left"
                                   Style="{StaticResource MaterialDesignSubtitle2TextBlock}" />
                        <Button Grid.Row="0"
                                HorizontalAlignment="Right"
                                Margin="0"
                                Width="32"
                                Height="32"
                                Command="{x:Static materialDesign:Flipper.FlipCommand}"
                                Content="{materialDesign:PackIcon Kind=SwapHorizontalBold}"
                                Style="{StaticResource MaterialDesignIconButton}" />
                        <TreeView Grid.Row="1"
                                  Margin="0,10,0,0"
                                  SelectedItemChanged="TreeView_OnSelectedItemChanged"
                                  ItemsSource="{Binding Source={x:Static endpoints:ModelRegister.ProviderEntries},Mode=OneWay}">
                            <TreeView.Resources>
                                <HierarchicalDataTemplate DataType="{x:Type endpoints:ProviderEntry}"
                                                          ItemsSource="{Binding ModelEntries,Mode=OneTime}">
                                    <TextBlock Text="{Binding ProviderName,Mode=OneTime}" />
                                </HierarchicalDataTemplate>
                                <HierarchicalDataTemplate DataType="{x:Type endpoints:ModelEntry}"
                                                          ItemsSource="{Binding InstanceList,Mode=OneTime}">
                                    <TextBlock Text="{Binding ModelName,Mode=OneTime}" />
                                </HierarchicalDataTemplate>
                                <DataTemplate DataType="{x:Type openAiapi:APIModelInfo}">
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} ({1})">
                                                <Binding Path="Endpoint.DisplayName" Mode="OneTime" />
                                                <Binding Path="PriceCalculator" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                                <DataTemplate DataType="{x:Type models:AzureModelInfo}">
                                    <TextBlock>
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} ({1})">
                                                <Binding Path="Endpoint.DisplayName" Mode="OneTime" />
                                                <Binding Path="PriceCalculator" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </DataTemplate>
                            </TreeView.Resources>
                        </TreeView>
                    </Grid>
                </materialDesign:Flipper.BackContent>
            </materialDesign:Flipper>
            <Grid Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <ToggleButton Style="{StaticResource MaterialDesignFlatToggleButton}"
                              ToolTip="Show Model Parameters"
                              Height="32"
                              Width="32"
                              Visibility="{Binding SelectedModel,Mode=OneWay,Converter={x:Static materialDesign:NullableToVisibilityConverter.CollapsedInstance}}"
                              IsChecked="{Binding ShowModelParams,Mode=TwoWay}">
                    <materialDesign:PackIcon Width="21"
                                             Height="21"
                                             Kind="Settings" />
                </ToggleButton>
                <TextBlock Grid.Column="1"
                           Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                           TextWrapping="NoWrap"
                           Margin="10,0"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           DataContext="{Binding SelectedModel,Mode=OneWay}"
                           Text="{Binding Path=Name, TargetNullValue=无,Mode=OneWay}" />
                <StackPanel Grid.Column="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right">
                    <Button Command="{x:Static viewModel:BaseModelSelectionViewModel.CreateDefaultCommand}"
                            CommandParameter="{Binding }"
                            Content="确认"
                            Height="32"
                            Padding="20,0"
                            Style="{StaticResource MaterialDesignRaisedButton}"
                            Margin="10,0,0,0" />
                </StackPanel>
            </Grid>
            <ScrollViewer MaxHeight="300"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Visibility="{Binding ShowModelParams,Mode=OneWay,Converter={StaticResource BooleanToVisibilityConverter}}">
                <openAiapi:LlmClientBaseView DataContext="{Binding Mode=OneTime}" />
            </ScrollViewer>
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="PriceCalculatorDataTemplate" DataType="{x:Type endpoints:TokenBasedPriceCalculator}">
        <StackPanel Orientation="Horizontal">
            <TextBlock Text="Input Price:"
                       VerticalAlignment="Center" />
            <TextBox materialDesign:TextFieldAssist.SuffixText="/M tokens"
                     Margin="6,0,0,0"
                     Width="120"
                     Text="{Binding InputPrice,Mode=TwoWay}" />
            <TextBlock Text="Output Price:"
                       VerticalAlignment="Center"
                       Margin="16,0,0,0" />
            <TextBox materialDesign:TextFieldAssist.SuffixText="/M tokens"
                     Margin="6,0,0,0"
                     Width="120"
                     Text="{Binding OutputPrice,Mode=TwoWay}" />
            <TextBlock Text="Ratio:"
                       VerticalAlignment="Center"
                       Margin="16,0,0,0" />
            <TextBox Text="{Binding DiscountFactor,Mode=TwoWay}"
                     Margin="6,0,0,0"
                     Width="50" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="ApiModelInfoDataTemplate"
                  DataType="{x:Type openAiapi:APIModelInfo}">
        <Grid Margin="10,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <StackPanel>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                               TextWrapping="Wrap"
                               VerticalAlignment="Bottom">
                        <Run Text="{Binding Name,Mode=OneWay}"
                             FontSize="18"
                             FontWeight="Bold" />
                        <Run FontSize="12"> (</Run>
                        <Run Text="{Binding APIId,Mode=OneWay}"
                             FontSize="12" />
                        <Run FontSize="12">)</Run>
                    </TextBlock>
                    <Image Grid.Column="1"
                           Width="40"
                           Height="40"
                           Source="{Binding Icon.CurrentSource,Mode=OneWay}" />
                </Grid>
                <TextBlock FontSize="12"
                           Margin="0,5,0,0">
                    <TextBlock.Text>
                        <MultiBinding StringFormat="Max Tokens:{0}   Max Context Size:{1}">
                            <Binding Path="MaxContextSize" Mode="OneWay" />
                            <Binding Path="MaxTokenLimit" Mode="OneWay" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
                <ContentPresenter Content="{Binding Telemetry,Mode=OneWay}"
                                  ContentTemplate="{StaticResource UsageCountDataTemplate}"
                                  Visibility="{Binding Telemetry,Mode=OneWay,Converter={x:Static materialDesign:NullableToVisibilityConverter.CollapsedInstance}}" />
                <ContentControl Content="{Binding PriceCalculator,Mode=OneWay}"
                                IsEnabled="False"
                                Margin="0,10,0,0"
                                ContentTemplate="{StaticResource PriceCalculatorDataTemplate}" />
                <TextBlock Margin="0,10,0,0"
                           Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                           TextWrapping="Wrap"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           Visibility="{Binding InfoUrl,Mode=OneWay,Converter={x:Static materialDesign:NullableToVisibilityConverter.CollapsedInstance}}">
                    <Hyperlink NavigateUri="{Binding InfoUrl,Mode=OneWay}"
                               TextDecorations="Underline"
                               RequestNavigate="Hyperlink_OnRequestNavigate">
                        <Hyperlink.Style>
                            <Style TargetType="{x:Type Hyperlink}"
                                   BasedOn="{StaticResource {x:Type Hyperlink}}">
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver"
                                             Value="True">
                                        <Setter Property="Foreground"
                                                Value="DodgerBlue" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Hyperlink.Style>
                        <Run Text="{Binding InfoUrl,Mode=OneWay}" />
                    </Hyperlink>
                </TextBlock>
                <WrapPanel Margin="0,10"
                           Orientation="Horizontal">
                    <WrapPanel.Resources>
                        <Style TargetType="{x:Type CheckBox}"
                               BasedOn="{StaticResource {x:Type CheckBox}}">
                            <Setter Property="Margin"
                                    Value="0,0,10,0" />
                            <Setter Property="materialDesign:CheckBoxAssist.CheckBoxSize"
                                    Value="30" />
                            <Setter Property="IsHitTestVisible"
                                    Value="False" />
                            <Setter Property="Height"
                                    Value="40" />
                        </Style>
                    </WrapPanel.Resources>
                    <CheckBox IsChecked="{Binding Reasonable,Mode=OneWay}"
                              Content="Support Reasoning"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Center" />
                    <CheckBox IsChecked="{Binding SupportStreaming,Mode=OneWay}"
                              Content="Support Streaming" />
                    <CheckBox IsChecked="{Binding SupportImageInput,Mode=OneWay}"
                              Content="Support Image Input" />
                    <CheckBox IsChecked="{Binding  SupportAudioInput,Mode=OneWay}"
                              Content="Support Audio Input" />
                    <CheckBox IsChecked="{Binding  SupportVideoInput,Mode=OneWay}"
                              Content="Support Video Input" />
                    <CheckBox IsChecked="{Binding SupportTextGeneration,Mode=OneWay}"
                              Content="Support Text Generation" />
                    <CheckBox IsChecked="{Binding SupportImageGeneration,Mode=OneWay}"
                              Content="Support Image Output" />
                    <CheckBox IsChecked="{Binding SupportSearch,Mode=OneWay}"
                              Content="Support Search" />
                    <CheckBox IsChecked="{Binding SupportFunctionCall,Mode=OneWay}"
                              Content="Support Function Call" />
                </WrapPanel>
            </StackPanel>
            <FlowDocumentScrollViewer Grid.Row="1"
                                      Document="{Binding Description,Mode=OneWay, Converter={x:Static converters:MarkdownToDocumentConverter.Instance}}" />
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="FullModelSelectionDataTemplate"
                  DataType="{x:Type viewModel:BaseModelSelectionViewModel}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <TabControl Width="300">
                <TabItem Header="Endpoints View">
                    <TreeView SelectedItemChanged="TreeView_OnSelectedItemChanged"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              MouseDoubleClick="TreeView_OnMouseDoubleClick"
                              ItemsSource="{Binding Source={StaticResource EndpointService},Path=CandidateEndpoints,Mode=OneWay}"
                              ItemTemplateSelector="{StaticResource ModelsDataTemplateSelector}" />
                </TabItem>
                <TabItem Header="Models View">
                    <TreeView SelectedItemChanged="TreeView_OnSelectedItemChanged"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              MouseDoubleClick="TreeView_OnMouseDoubleClick"
                              ItemsSource="{Binding Source={x:Static endpoints:ModelRegister.ProviderEntries},Mode=OneWay}">
                        <TreeView.Resources>
                            <HierarchicalDataTemplate DataType="{x:Type endpoints:ProviderEntry}"
                                                      ItemsSource="{Binding ModelEntries,Mode=OneTime}">
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding Icon.CurrentSource,Mode=OneWay}"
                                           Width="26"
                                           Height="26"
                                           Visibility="{Binding Icon,Mode=OneWay}" />
                                    <TextBlock Text="{Binding ProviderName,Mode=OneTime}"
                                               Margin="10,0"
                                               VerticalAlignment="Center" />
                                </StackPanel>
                            </HierarchicalDataTemplate>
                            <HierarchicalDataTemplate DataType="{x:Type endpoints:ModelEntry}"
                                                      ItemsSource="{Binding InstanceList,Mode=OneTime}">
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding Icon.CurrentSource,Mode=OneWay}"
                                           Width="26"
                                           Height="26" />
                                    <TextBlock Text="{Binding ModelName,Mode=OneTime}"
                                               VerticalAlignment="Center"
                                               Margin="10,0" />
                                </StackPanel>
                            </HierarchicalDataTemplate>
                            <DataTemplate DataType="{x:Type openAiapi:APIModelInfo}">
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding Endpoint.Icon.CurrentSource,Mode=OneWay}"
                                           Width="26"
                                           Height="26" />
                                    <TextBlock VerticalAlignment="Center"
                                               Margin="10,0">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} ({1})">
                                                <Binding Path="Endpoint.DisplayName" Mode="OneTime" />
                                                <Binding Path="PriceCalculator" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                            <DataTemplate DataType="{x:Type models:AzureModelInfo}">
                                <StackPanel Orientation="Horizontal">
                                    <Image Source="{Binding Endpoint.Icon.CurrentSource,Mode=OneWay}"
                                           Width="26"
                                           Height="26" />
                                    <TextBlock VerticalAlignment="Center"
                                               Margin="10,0">
                                        <TextBlock.Text>
                                            <MultiBinding StringFormat="{}{0} ({1})">
                                                <Binding Path="Endpoint.DisplayName" Mode="OneTime" />
                                                <Binding Path="PriceCalculator" />
                                            </MultiBinding>
                                        </TextBlock.Text>
                                    </TextBlock>
                                </StackPanel>
                            </DataTemplate>
                        </TreeView.Resources>
                        <b:Interaction.Triggers>
                            <b:EventTrigger EventName="MouseDoubleClick">
                                <b:InvokeCommandAction CommandParameter="{Binding }"
                                                       Command="{x:Static viewModel:BaseModelSelectionViewModel.CreateDefaultCommand}" />
                            </b:EventTrigger>
                        </b:Interaction.Triggers>
                    </TreeView>
                </TabItem>
            </TabControl>
            <Separator Grid.Column="0"
                       VerticalAlignment="Stretch"
                       Background="DarkGray"
                       Margin="0,20"
                       Width="1"
                       Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"
                       HorizontalAlignment="Right" />
            <ContentControl Grid.Column="1"
                            Content="{Binding SelectedModel,Mode=OneWay}">
                <ContentControl.ContentTemplateSelector>
                    <component:TypeBasedDataTemplateSelector>
                        <component:DataTemplateTypePair>
                            <DataTemplate DataType="{x:Type models:AzureModelInfo}">
                                <models:AzureModelInfoView Margin="10" />
                            </DataTemplate>
                        </component:DataTemplateTypePair>
                        <component:DataTemplateTypePair Template="{StaticResource ApiModelInfoDataTemplate}" />
                    </component:TypeBasedDataTemplateSelector>
                </ContentControl.ContentTemplateSelector>
            </ContentControl>
        </Grid>
    </DataTemplate>
    <DataTemplate x:Key="ProxyOptionDataTemplate" DataType="{x:Type configuration:ProxyOption}">
        <StackPanel>
            <RadioButton Content="Default (Based on initial env when app start)"
                         IsChecked="{Binding ProxyType, 
                                    Converter={StaticResource  EnumToBoolConverter}, 
                                    ConverterParameter={x:Static configuration:ProxyType.Default},
                                    UpdateSourceTrigger=PropertyChanged}" />
            <RadioButton Content="Direct"
                         Margin="0,10,0,0"
                         IsChecked="{Binding ProxyType, 
                                    Converter={StaticResource EnumToBoolConverter}, 
                                    ConverterParameter={x:Static configuration:ProxyType.Direct},
                                    UpdateSourceTrigger=PropertyChanged}" />

            <RadioButton Content="Monitor Env Changes"
                         Margin="0,10,0,0"
                         IsChecked="{Binding ProxyType, 
                                    Converter={StaticResource EnumToBoolConverter}, 
                                    ConverterParameter={x:Static configuration:ProxyType.System},
                                    UpdateSourceTrigger=PropertyChanged}" />
            <RadioButton Margin="0,10,0,0"
                         HorizontalContentAlignment="Stretch"
                         IsChecked="{Binding ProxyType, 
                                    Converter={StaticResource EnumToBoolConverter}, 
                                    ConverterParameter={x:Static configuration:ProxyType.Custom},
                                    UpdateSourceTrigger=PropertyChanged}">
                <Grid Margin="0,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <TextBlock VerticalAlignment="Center">Custom</TextBlock>
                    <TextBox Grid.Column="1"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             Padding="8,6"
                             HorizontalAlignment="Stretch"
                             materialDesign:TextFieldAssist.HasClearButton="True"
                             materialDesign:HintAssist.Hint="support socket or http mode."
                             VerticalAlignment="Center"
                             Text="{Binding ProxyString,Mode=TwoWay}"
                             Margin="10,0,0,0" />
                </Grid>
            </RadioButton>
        </StackPanel>
    </DataTemplate>


    <DataTemplate x:Key="ProjectConfigDataTemplate"
                  DataType="{x:Type project:ProjectOption}">
        <Grid Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="80" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <TextBox Margin="0"
                         materialDesign:HintAssist.Hint="输入项目名称"
                         TextWrapping="NoWrap"
                         MaxWidth="120"
                         MinWidth="80"
                         Text="{Binding Name, Mode=TwoWay}" />
                <ComboBox Grid.Column="1"
                          Margin="6,0"
                          IsEnabled="{Binding TypeEditable,Mode=OneTime}"
                          ItemsSource="{Binding Source={extension:EnumBindingSource {x:Type project:ProjectType}}}"
                          SelectedItem="{Binding Type,Mode=TwoWay}" />
                <TextBox Grid.Row="0" Grid.Column="2"
                         TextWrapping="NoWrap"
                         Margin="5,0"
                         materialDesign:HintAssist.Hint="选择项目根目录"
                         Text="{Binding RootPath,Mode=TwoWay}"
                         TextAlignment="Left" />
                <Button Grid.Row="0" Grid.Column="2"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,5,0"
                        Width="30"
                        Height="30"
                        Command="{Binding SelectProjectFolderCommand}"
                        Content="{materialDesign:PackIcon Kind=FolderSettingsOutline,Size=16}"
                        Style="{StaticResource MaterialDesignIconForegroundButton}" />
            </Grid>
            <TextBox Grid.Row="1"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     materialDesign:HintAssist.Hint="输入项目描述"
                     MinHeight="60"
                     Margin="0,6"
                     Text="{Binding Description,Mode=TwoWay}" />
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                           Text="工具可访问路径："
                           VerticalAlignment="Center" />
                <ListBox Grid.Column="1"
                         ItemsSource="{Binding AllowedFolderPaths,Mode=OneWay}">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="{x:Type ListBoxItem}"
                               BasedOn="{StaticResource {x:Type ListBoxItem}}">
                            <Setter Property="HorizontalContentAlignment"
                                    Value="Stretch" />
                            <Setter Property="Padding"
                                    Value="0,4" />
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="{x:Type sys:String}">
                            <Grid>
                                <TextBlock Text="{Binding}"
                                           Margin="5,0,0,0"
                                           VerticalAlignment="Center"
                                           Style="{StaticResource MaterialDesignCaptionTextBlock}" />
                                <Button Width="20"
                                        Height="20"
                                        Template="{StaticResource ItemDeleteButtonTemplate}"
                                        ToolTip="删除当前"
                                        Margin="0,0,6,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Command="{Binding DataContext.RemoveAllowedFolderPathCommand, RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}}"
                                        CommandParameter="{Binding}" />
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <Button Grid.Column="2"
                        VerticalAlignment="Bottom"
                        HorizontalAlignment="Right"
                        Margin="6"
                        Width="30"
                        Height="30"
                        BorderThickness="1"
                        Content="{materialDesign:PackIcon Kind=Plus,Size=21}"
                        Style="{StaticResource MaterialDesignFloatingActionMiniSecondaryButton}"
                        Command="{Binding AddAllowedFolderPathsCommand}" />
            </Grid>
        </Grid>
    </DataTemplate>
    <DataTemplate x:Key="CSharpProjectViewModelDataTemplate"
                  DataType="{x:Type project:CSharpProjectViewModel}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <ContentPresenter Content="{Binding Option}"
                              ContentTemplate="{StaticResource ProjectConfigDataTemplate}" />
            <TextBox Grid.Row="1"
                     materialDesign:HintAssist.Hint="Solution File Path (.sln)"
                     Text="{Binding SolutionFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Grid.Row="1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Margin="0,0,5,0"
                    Width="30"
                    Height="30"
                    Command="{Binding SelectPathCommand}"
                    Content="{materialDesign:PackIcon Kind=FilePlusOutline,Size=16}"
                    Style="{StaticResource MaterialDesignIconForegroundButton}" />
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="PromptDataTemplate"
                  DataType="{x:Type configuration:PromptEntry}">
        <DockPanel>
            <TextBlock Text="{Binding Title,Mode=OneWay}"
                       FontWeight="Black"
                       Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                       TextWrapping="NoWrap"
                       TextTrimming="WordEllipsis"
                       DockPanel.Dock="Top" />
            <TextBlock Text="{Binding Prompt,Mode=OneWay}"
                       Style="{StaticResource MaterialDesignBody2TextBlock}"
                       Margin="0,2,0,0"
                       MaxHeight="60"
                       ToolTipService.InitialShowDelay="0"
                       ToolTipService.Placement="Bottom">
                <TextBlock.ToolTip>
                    <ToolTip Content="{Binding Path=Prompt, Mode=OneWay}"
                             Placement="Bottom"
                             PlacementTarget="{Binding RelativeSource={RelativeSource Self}}">
                        <ToolTip.ContentTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}"
                                           MaxWidth="800"
                                           TextWrapping="Wrap" />
                            </DataTemplate>
                        </ToolTip.ContentTemplate>
                    </ToolTip>
                </TextBlock.ToolTip>
            </TextBlock>
            <DockPanel.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Copy"
                              Icon="{materialDesign:PackIcon Kind=ContentCopy}"
                              Command="{x:Static utility:CommonCommands.CopyCommand}"
                              CommandParameter="{Binding Prompt,Mode=OneWay}" />
                </ContextMenu>
            </DockPanel.ContextMenu>
        </DockPanel>
    </DataTemplate>
</ResourceDictionary>